<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reclama√ß√µes - Acessibilidade em Transporte P√∫blico</title>
    <link rel="icon" href="../assets/imgs/logoPreta.png">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/relatorios.css">
    <script src="../js/sessao.js"></script>
    <style>
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background-color: #fff;
            margin: 5% auto;
            padding: 0;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            animation: slideDown 0.3s;
        }

        @keyframes slideDown {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 1.5rem;
            color: #1f2937;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #6b7280;
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .close-btn:hover {
            background-color: #f3f4f6;
            color: #1f2937;
        }

        .modal-body {
            padding: 24px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #374151;
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 0.95rem;
            transition: all 0.2s;
            box-sizing: border-box;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .checkbox-group {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .checkbox-item input[type="checkbox"] {
            width: auto;
            cursor: pointer;
        }

        .modal-footer {
            padding: 16px 24px;
            border-top: 1px solid #e5e7eb;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-secondary {
            background-color: #f3f4f6;
            color: #374151;
        }

        .btn-secondary:hover {
            background-color: #e5e7eb;
        }

        .btn-primary {
            background-color: #3b82f6;
            color: white;
        }

        .btn-primary:hover {
            background-color: #2563eb;
        }

        .btn-danger {
            background-color: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background-color: #dc2626;
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s;
        }

        .action-btn.edit {
            background-color: #3b82f6;
            color: white;
        }

        .action-btn.edit:hover {
            background-color: #2563eb;
        }

        .action-btn.delete {
            background-color: #ef4444;
            color: white;
        }

        .action-btn.delete:hover {
            background-color: #dc2626;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #6b7280;
        }

        .error-message {
            background-color: #fee2e2;
            color: #991b1b;
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 16px;
            display: none;
        }

        .success-message {
            background-color: #d1fae5;
            color: #065f46;
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 16px;
            display: none;
        }
    </style>
</head>
<body onload="validarSessao(); carregarDados();">
    <div class="dashboard">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <img src="../assets/imgs/logo.svg" alt="" width="120px">
                </div>
            </div>
            <nav class="nav-menu">
                <a href="perfil.html" class="nav-item">
                    <i class="fa fa-user-circle-o"></i>
                    <span>Perfil</span>
                </a>
                <a href="painel.html" class="nav-item" id="menuPainel" style="display: none;">
                    <i class="fas fa-cogs"></i>
                    <span>Painel</span>
                </a>
                <a href="mural.html" class="nav-item">
                    <i class="fas fa-chart-bar"></i>
                    <span>Dashboard</span>
                </a>
                <a href="relatorios.html" class="nav-item active">
                    <i class="fas fa-chart-line"></i>
                    <span>Relat√≥rios</span>
                </a>
                <a href="../index.html" class="nav-item" id="sair">
                    <i class="fa-solid fa-door-open"></i>
                    <span onclick="limparSessao()">Sair</span>
                </a>
            </nav>
        </aside>

        <div class="main-content">
            <header class="header">
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <button class="nav-toggle" aria-label="abrir menu">
                        <div class="hamburger-line"></div>
                        <div class="hamburger-line"></div>
                        <div class="hamburger-line"></div>
                    </button>
                    <h1>Relat√≥rios</h1>
                </div>
            </header>

            <main class="content">
                <div class="stats-grid-wrapper">
                    <div class="stats-grid">
                        <div class="status-card status-total">
                            <div class="status-card-icon">
                                <i class="fas fa-file-alt"></i>
                            </div>
                            <div class="status-label">Total de Reclama√ß√µes</div>
                            <div class="status-number" id="total-reclamacoes">0</div>
                            <div class="status-subtitle">√öltimos 30 dias</div>
                        </div>

                        <div class="status-card status-pendente">
                            <div class="status-card-icon">
                                <i class="fas fa-exclamation-circle"></i>
                            </div>
                            <div class="status-label">Pendentes</div>
                            <div class="status-number" id="total-pendentes">0</div>
                            <div class="status-subtitle">Aguardando resolu√ß√£o</div>
                        </div>

                        <div class="status-card status-andamento">
                            <div class="status-card-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="status-label">Em Andamento</div>
                            <div class="status-number" id="total-andamento">0</div>
                            <div class="status-subtitle">Sendo resolvidas</div>
                        </div>

                        <div class="status-card status-resolvido">
                            <div class="status-card-icon">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <div class="status-label">Resolvidas</div>
                            <div class="status-number" id="total-resolvidas">0</div>
                            <div class="status-subtitle" id="taxa-resolucao">Taxa de resolu√ß√£o: 0%</div>
                        </div>
                    </div>
                </div>

                <div class="main-content-reclamacoes">
                    <div class="section-header">
                        <h2 class="section-title">Relat√≥rio de Reclama√ß√µes</h2>
                        <div style="display: flex; align-items: center; gap: 16px;">
                            <div class="search-box">
                                <i class="fas fa-search" style="color: #9ca3af;"></i>
                                <input type="text" id="search-input" placeholder="Buscar por ID, tipo ou local...">
                            </div>
                            <button class="btn-nova-reclamacao" onclick="abrirModalCriar()">
                                <i class="fas fa-plus"></i>
                                Nova Reclama√ß√£o
                            </button>
                        </div>
                    </div>

                    <div id="error-container" class="error-message"></div>
                    <div id="success-container" class="success-message"></div>

                    <div id="loading" class="loading">
                        <i class="fas fa-spinner fa-spin" style="font-size: 2rem;"></i>
                        <p>Carregando reclama√ß√µes...</p>
                    </div>

                    <table class="reclamacoes-table" id="tabela-reclamacoes" style="display: none;">
                        <thead>
                            <tr>
                                <th style="width: 100px;">ID</th>
                                <th style="width: 140px;">Data/Hora</th>
                                <th style="width: 150px;">Tipo</th>
                                <th style="width: 180px;">Local/Ve√≠culo</th>
                                <th style="width: 120px;">Status</th>
                                <th>Descri√ß√£o</th>
                                <th style="width: 140px;">A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="tbody-reclamacoes">
                        </tbody>
                    </table>
                </div>
            </main>
        </div>
    </div>

    <div id="modal-reclamacao" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">Nova Reclama√ß√£o</h2>
                <button class="close-btn" onclick="fecharModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="form-reclamacao">
                    <input type="hidden" id="reclamacao-id">

                    <div class="form-group">
                        <label for="tipo">Tipo de Reclama√ß√£o *</label>
                        <input type="text" id="tipo" placeholder="Ex: Elevador Inoperante, Rampa de Acesso..." required>
                    </div>

                    <div class="form-group">
                        <label for="descricao">Descri√ß√£o *</label>
                        <textarea id="descricao" placeholder="Descreva o problema em detalhes..." required></textarea>
                    </div>

                    <div class="form-group">
                        <label>Relacionado a: *</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="check-veiculo" onchange="toggleSelects()">
                                <label for="check-veiculo" style="margin: 0; font-weight: normal;">Ve√≠culo</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="check-local" onchange="toggleSelects()">
                                <label for="check-local" style="margin: 0; font-weight: normal;">Local de Embarque</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group" id="group-veiculo" style="display: none;">
                        <label for="fkVeiculo">Selecionar Ve√≠culo</label>
                        <select id="fkVeiculo"></select>
                    </div>

                    <div class="form-group" id="group-local" style="display: none;">
                        <label for="fkLocalEmbarque">Selecionar Local de Embarque</label>
                        <select id="fkLocalEmbarque"></select>
                    </div>

                    <div class="form-group">
                        <label for="statusReclamacao">Status</label>
                        <select id="statusReclamacao">
                            <option value="Pendente">Pendente</option>
                            <option value="Em andamento">Em Andamento</option>
                            <option value="Resolvido">Resolvido</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="fecharModal()">Cancelar</button>
                <button class="btn btn-primary" onclick="salvarReclamacao()">Salvar</button>
            </div>
        </div>
    </div>

    <script>
        // --- AQUI ESTAVA O ERRO ---
        // Alterado de 'http://localhost:8080/reclamacoes' para '/reclamacoes'
        const API_URL = '/reclamacoes'; 
        
        let veiculos = [];
        let locais = [];
        let modoEdicao = false;

        // ==================== FUN√á√ÉO PARA PEGAR ID DO USU√ÅRIO ====================
        function obterIdUsuario() {
            const idUsuario = sessionStorage.getItem('ID_USUARIO');
            
            if (!idUsuario) {
                console.error('‚ùå ID do usu√°rio n√£o encontrado no sessionStorage');
                mostrarErro('Sess√£o expirada. Por favor, fa√ßa login novamente.');
                setTimeout(() => {
                    window.location.href = '../index.html';
                }, 2000);
                return null;
            }
            
            console.log('‚úÖ ID do usu√°rio:', idUsuario);
            return idUsuario;
        }

        // ==================== CARREGAR DADOS INICIAIS ====================
        async function carregarDados() {
            try {
                const idUsuario = obterIdUsuario();
                if (!idUsuario) return;
                
                console.log('üîÑ Iniciando carregamento de dados...');
                console.log('üì° API URL:', API_URL);
                console.log('üë§ ID Usu√°rio:', idUsuario);
                
                await Promise.all([
                    carregarEstatisticas(idUsuario),
                    carregarReclamacoes(idUsuario),
                    carregarVeiculos(),
                    carregarLocais()
                ]);
                
                console.log('‚úÖ Dados carregados com sucesso!');
            } catch (error) {
                console.error('‚ùå Erro ao carregar dados:', error);
                mostrarErro('Erro ao carregar dados iniciais: ' + error.message);
            }
        }

        // ==================== CARREGAR ESTAT√çSTICAS ====================
        async function carregarEstatisticas(idUsuario) {
            try {
                console.log('üìä Carregando estat√≠sticas...');
                const response = await fetch(`${API_URL}/estatisticas?idUsuario=${idUsuario}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const stats = await response.json();
                console.log('üìä Estat√≠sticas recebidas:', stats);
                
                document.getElementById('total-reclamacoes').textContent = stats.total || 0;
                document.getElementById('total-pendentes').textContent = stats.pendentes || 0;
                document.getElementById('total-andamento').textContent = stats.emAndamento || 0;
                document.getElementById('total-resolvidas').textContent = stats.resolvidas || 0;
                
                const taxa = stats.total > 0 ? Math.round((stats.resolvidas / stats.total) * 100) : 0;
                document.getElementById('taxa-resolucao').textContent = `Taxa de resolu√ß√£o: ${taxa}%`;
            } catch (error) {
                console.error('‚ùå Erro ao carregar estat√≠sticas:', error);
                throw error;
            }
        }

        // ==================== CARREGAR RECLAMA√á√ïES ====================
        async function carregarReclamacoes(idUsuario) {
            try {
                if (!idUsuario) {
                    idUsuario = obterIdUsuario();
                    if (!idUsuario) return;
                }
                
                document.getElementById('loading').style.display = 'block';
                document.getElementById('tabela-reclamacoes').style.display = 'none';
                
                console.log('üìã Carregando reclama√ß√µes do usu√°rio:', idUsuario);
                const response = await fetch(`${API_URL}?idUsuario=${idUsuario}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const reclamacoes = await response.json();
                console.log('üìã Reclama√ß√µes recebidas:', reclamacoes.length);
                
                const tbody = document.getElementById('tbody-reclamacoes');
                tbody.innerHTML = '';
                
                if (reclamacoes.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 40px;">Nenhuma reclama√ß√£o encontrada</td></tr>';
                } else {
                    reclamacoes.forEach(rec => {
                        tbody.innerHTML += criarLinhaTabela(rec);
                    });
                }
                
                document.getElementById('loading').style.display = 'none';
                document.getElementById('tabela-reclamacoes').style.display = 'table';
            } catch (error) {
                console.error('‚ùå Erro ao carregar reclama√ß√µes:', error);
                mostrarErro('Erro ao carregar reclama√ß√µes: ' + error.message);
                document.getElementById('loading').style.display = 'none';
            }
        }

        // ==================== CRIAR LINHA DA TABELA ====================
        function criarLinhaTabela(rec) {
            const dataFormatada = new Date(rec.dataHoraCriacao).toLocaleString('pt-BR');
            const localOuVeiculo = rec.localNome 
                ? `${rec.localNome} - ${rec.localLinha || ''}`
                : (rec.veiculoTipo ? `${rec.veiculoTipo} - ${rec.veiculoModelo || ''}` : 'N/A');
            const statusClass = rec.statusReclamacao.toLowerCase().replace(' ', '-');
            
            return `
                <tr>
                    <td><div class="reclamacao-id">REC-${String(rec.idReclamacao).padStart(4, '0')}</div></td>
                    <td><div class="reclamacao-data">${dataFormatada}</div></td>
                    <td><span class="tipo-badge">${rec.tipo}</span></td>
                    <td>${localOuVeiculo}</td>
                    <td><span class="status-badge status-${statusClass}">${rec.statusReclamacao}</span></td>
                    <td><div class="reclamacao-descricao">${rec.descricao}</div></td>
                    <td>
                        <div class="action-buttons">
                            <button class="action-btn edit" onclick="editarReclamacao(${rec.idReclamacao})" title="Editar">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn delete" onclick="confirmarExclusao(${rec.idReclamacao})" title="Excluir">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `;
        }

        // ==================== CARREGAR VE√çCULOS ====================
        async function carregarVeiculos() {
            try {
                const response = await fetch(`${API_URL}/veiculos`);
                veiculos = await response.json();
                
                const select = document.getElementById('fkVeiculo');
                select.innerHTML = '<option value="">Selecione um ve√≠culo</option>';
                veiculos.forEach(v => {
                    select.innerHTML += `<option value="${v.idVeiculo}">${v.tipoTransporte} - ${v.tipoVeiculo}</option>`;
                });
            } catch (error) {
                console.error('‚ùå Erro ao carregar ve√≠culos:', error);
            }
        }

        // ==================== CARREGAR LOCAIS ====================
        async function carregarLocais() {
            try {
                const response = await fetch(`${API_URL}/locais`);
                locais = await response.json();
                
                const select = document.getElementById('fkLocalEmbarque');
                select.innerHTML = '<option value="">Selecione um local</option>';
                locais.forEach(l => {
                    select.innerHTML += `<option value="${l.idLocal}">${l.nome} - ${l.linha_frota || l.municipio}</option>`;
                });
            } catch (error) {
                console.error('‚ùå Erro ao carregar locais:', error);
            }
        }

        // ==================== MODAL ====================
        function abrirModalCriar() {
            modoEdicao = false;
            document.getElementById('modal-title').textContent = 'Nova Reclama√ß√£o';
            document.getElementById('form-reclamacao').reset();
            document.getElementById('reclamacao-id').value = '';
            document.getElementById('check-veiculo').checked = false;
            document.getElementById('check-local').checked = false;
            toggleSelects();
            document.getElementById('modal-reclamacao').style.display = 'block';
        }

        async function editarReclamacao(id) {
            try {
                const response = await fetch(`${API_URL}/${id}`);
                const rec = await response.json();
                
                modoEdicao = true;
                document.getElementById('modal-title').textContent = 'Editar Reclama√ß√£o';
                document.getElementById('reclamacao-id').value = rec.idReclamacao;
                document.getElementById('tipo').value = rec.tipo;
                document.getElementById('descricao').value = rec.descricao;
                document.getElementById('statusReclamacao').value = rec.statusReclamacao;
                
                document.getElementById('check-veiculo').checked = !!rec.fkVeiculo;
                document.getElementById('check-local').checked = !!rec.fkLocalEmbarque;
                toggleSelects();
                
                if (rec.fkVeiculo) {
                    document.getElementById('fkVeiculo').value = rec.fkVeiculo;
                }
                if (rec.fkLocalEmbarque) {
                    document.getElementById('fkLocalEmbarque').value = rec.fkLocalEmbarque;
                }
                
                document.getElementById('modal-reclamacao').style.display = 'block';
            } catch (error) {
                mostrarErro('Erro ao carregar dados da reclama√ß√£o');
            }
        }

        function fecharModal() {
            document.getElementById('modal-reclamacao').style.display = 'none';
        }

        function toggleSelects() {
            const checkVeiculo = document.getElementById('check-veiculo').checked;
            const checkLocal = document.getElementById('check-local').checked;
            
            document.getElementById('group-veiculo').style.display = checkVeiculo ? 'block' : 'none';
            document.getElementById('group-local').style.display = checkLocal ? 'block' : 'none';
            
            if (!checkVeiculo) {
                document.getElementById('fkVeiculo').value = '';
            }
            if (!checkLocal) {
                document.getElementById('fkLocalEmbarque').value = '';
            }
        }

        // ==================== SALVAR RECLAMA√á√ÉO ====================
        async function salvarReclamacao() {
            const idUsuario = obterIdUsuario();
            if (!idUsuario) return;
            
            const tipo = document.getElementById('tipo').value.trim();
            const descricao = document.getElementById('descricao').value.trim();
            const statusReclamacao = document.getElementById('statusReclamacao').value;
            const checkVeiculo = document.getElementById('check-veiculo').checked;
            const checkLocal = document.getElementById('check-local').checked;
            const fkVeiculo = document.getElementById('fkVeiculo').value;
            const fkLocalEmbarque = document.getElementById('fkLocalEmbarque').value;
            
            // Valida√ß√µes
            if (!tipo || !descricao) {
                mostrarErro('Preencha todos os campos obrigat√≥rios');
                return;
            }
            
            if (!checkVeiculo && !checkLocal) {
                mostrarErro('Selecione ao menos Ve√≠culo ou Local de Embarque');
                return;
            }
            
            if (checkVeiculo && !fkVeiculo) {
                mostrarErro('Selecione um ve√≠culo');
                return;
            }
            
            if (checkLocal && !fkLocalEmbarque) {
                mostrarErro('Selecione um local de embarque');
                return;
            }
            
            const dados = {
                tipo,
                descricao,
                statusReclamacao,
                fkVeiculo: checkVeiculo ? fkVeiculo : null,
                fkLocalEmbarque: checkLocal ? fkLocalEmbarque : null,
                fkUsuario: idUsuario
            };
            
            try {
                let response;
                if (modoEdicao) {
                    const id = document.getElementById('reclamacao-id').value;
                    response = await fetch(`${API_URL}/${id}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(dados)
                    });
                } else {
                    response = await fetch(API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(dados)
                    });
                }
                
                if (response.ok) {
                    mostrarSucesso(modoEdicao ? 'Reclama√ß√£o atualizada!' : 'Reclama√ß√£o criada!');
                    fecharModal();
                    await carregarDados();
                } else {
                    const erro = await response.json();
                    mostrarErro(erro.erro || 'Erro ao salvar reclama√ß√£o');
                }
            } catch (error) {
                mostrarErro('Erro ao salvar reclama√ß√£o: ' + error.message);
            }
        }

        // ==================== EXCLUIR ====================
        function confirmarExclusao(id) {
            if (confirm('Tem certeza que deseja excluir esta reclama√ß√£o?')) {
                excluirReclamacao(id);
            }
        }

        async function excluirReclamacao(id) {
            try {
                const response = await fetch(`${API_URL}/${id}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    mostrarSucesso('Reclama√ß√£o exclu√≠da com sucesso!');
                    await carregarDados();
                } else {
                    mostrarErro('Erro ao excluir reclama√ß√£o');
                }
            } catch (error) {
                mostrarErro('Erro ao excluir reclama√ß√£o: ' + error.message);
            }
        }

        // ==================== BUSCA ====================
        document.getElementById('search-input').addEventListener('input', async (e) => {
            const termo = e.target.value.trim();
            const idUsuario = obterIdUsuario();
            
            if (!idUsuario) return;
            
            if (termo.length >= 3) {
                try {
                    const response = await fetch(`${API_URL}/buscar?termo=${encodeURIComponent(termo)}&idUsuario=${idUsuario}`);
                    const reclamacoes = await response.json();
                    
                    const tbody = document.getElementById('tbody-reclamacoes');
                    tbody.innerHTML = '';
                    
                    if (reclamacoes.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 40px;">Nenhum resultado encontrado</td></tr>';
                    } else {
                        reclamacoes.forEach(rec => {
                            tbody.innerHTML += criarLinhaTabela(rec);
                        });
                    }
                } catch (error) {
                    console.error('‚ùå Erro na busca:', error);
                }
            } else if (termo.length === 0) {
                carregarReclamacoes(idUsuario);
            }
        });

        // ==================== MENSAGENS ====================
        function mostrarErro(mensagem) {
            const container = document.getElementById('error-container');
            container.textContent = mensagem;
            container.style.display = 'block';
            setTimeout(() => {
                container.style.display = 'none';
            }, 5000);
        }

        function mostrarSucesso(mensagem) {
            const container = document.getElementById('success-container');
            container.textContent = mensagem;
            container.style.display = 'block';
            setTimeout(() => {
                container.style.display = 'none';
            }, 3000);
        }

        // ==================== SIDEBAR TOGGLE ====================
        const navToggle = document.querySelector('.nav-toggle');
        const sidebar = document.getElementById('sidebar');

        if (navToggle && sidebar) {
            navToggle.addEventListener('click', (e) => {
                e.stopPropagation();
                sidebar.classList.toggle('open');
            });
            
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', () => {
                    sidebar.classList.remove('open');
                });
            });
            
            document.addEventListener('click', (e) => {
                if (!sidebar.contains(e.target) && !navToggle.contains(e.target) && sidebar.classList.contains('open')) {
                    sidebar.classList.remove('open');
                }
            });
        }

        // ==================== FECHAR MODAL AO CLICAR FORA ====================
        window.onclick = function(event) {
            const modal = document.getElementById('modal-reclamacao');
            if (event.target == modal) {
                fecharModal();
            }
        }
        
        // ==================== VERIFICA√á√ÉO DE PERMISS√ÉO PAINEL ====================
        document.addEventListener('DOMContentLoaded', function() {
            var nivel = sessionStorage.NIVEL_USUARIO;
            var menuPainel = document.getElementById('menuPainel');
            
            // Mostrar/ocultar item Painel baseado no n√≠vel
            if (menuPainel) {
                if (nivel == 1 || nivel == 2) {
                    menuPainel.style.display = "flex";
                } else {
                    menuPainel.style.display = "none";
                }
            }
        });
    </script>
</body>
</html>